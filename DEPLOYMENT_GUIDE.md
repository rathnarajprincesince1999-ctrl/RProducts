# RATHNA Products - Server Setup & Deployment Guide

## Table of Contents
1. [Prerequisites](#prerequisites)
2. [Gitignored Files & Required Setup](#gitignored-files--required-setup)
3. [Local Development Setup](#local-development-setup)
4. [Production Server Setup](#production-server-setup)
5. [Database Configuration](#database-configuration)
6. [Backend Deployment](#backend-deployment)
7. [Frontend Deployment](#frontend-deployment)
8. [CI/CD Pipeline Setup](#cicd-pipeline-setup)
9. [Environment Configuration](#environment-configuration)
10. [SSL & Domain Setup](#ssl--domain-setup)
11. [Monitoring & Maintenance](#monitoring--maintenance)

## Prerequisites

### System Requirements
- **OS**: Ubuntu 20.04+ / CentOS 8+ / Windows Server 2019+
- **RAM**: Minimum 4GB (8GB recommended)
- **Storage**: Minimum 50GB SSD
- **CPU**: 2+ cores

### Required Software
- **Java**: OpenJDK 21
- **Node.js**: v18+ with npm
- **MySQL**: 8.0+
- **Nginx**: 1.18+ (for reverse proxy)
- **Git**: Latest version
- **PM2**: Process manager for Node.js
- **Certbot**: SSL certificate management

## Gitignored Files & Required Setup

### Files Excluded from Git (Must be Created on Server)

The following files are gitignored and must be manually created on the production server:

#### 1. Environment Configuration Files
```bash
# Backend environment file
/backend/.env
/backend/src/main/resources/application-prod.properties

# Frontend environment file
/fronend/.env.production
/fronend/.env.local
```

#### 2. Build Artifacts (Auto-generated)
```bash
# Frontend build files
/fronend/dist/
/fronend/build/
/fronend/node_modules/

# Backend build files
/backend/build/
/backend/out/
/backend/.gradle/
/backend/gradle/
*.jar
*.war
*.ear
```

#### 3. Upload Directories
```bash
# File upload directories (must be created with proper permissions)
/backend/uploads/
/backend/uploads/products/
/backend/uploads/categories/
```

#### 4. Log Files
```bash
# Application logs
logs/
*.log
/var/log/rathna/
```

#### 5. SSL Certificates
```bash
# SSL certificates (generated by certbot)
/etc/letsencrypt/
/etc/ssl/certs/rathna/
```

#### 6. Database Files
```bash
# Database files (if using local SQLite for development)
*.db
*.sqlite
```

#### 7. Cache and Temporary Files
```bash
# Cache directories
.cache/
.parcel-cache/
tmp/
temp/
*.tmp
*.temp
```

### Required Manual Setup Files

#### Create Backend Environment File
**File**: `/backend/.env`
```env
# Database Configuration
DB_HOST=203.57.85.97
DB_PORT=3306
DB_NAME=RATHNA
DB_USERNAME=developer
DB_PASSWORD=dev@MSQL25

# JWT Configuration
JWT_SECRET=your_super_secure_jwt_secret_key_here_minimum_256_bits
JWT_EXPIRATION=86400000

# File Upload Configuration
UPLOAD_DIR=/opt/rathna/uploads
MAX_FILE_SIZE=10MB

# Server Configuration
SERVER_PORT=8080
SERVER_CONTEXT_PATH=/api

# CORS Configuration
CORS_ALLOWED_ORIGINS=http://localhost:5173,https://yourdomain.com

# Logging Configuration
LOG_LEVEL=INFO
LOG_FILE=/var/log/rathna/application.log
```

#### Create Frontend Environment File
**File**: `/fronend/.env.production`
```env
# API Configuration
VITE_API_URL=https://yourdomain.com/api
VITE_API_TIMEOUT=30000

# Application Configuration
VITE_APP_NAME=RATHNA Products
VITE_APP_VERSION=1.0.0

# Upload Configuration
VITE_MAX_FILE_SIZE=10485760
VITE_ALLOWED_FILE_TYPES=image/jpeg,image/png,image/gif,image/webp

# Feature Flags
VITE_ENABLE_ANALYTICS=true
VITE_ENABLE_DEBUG=false
```

#### Create Production Spring Boot Configuration
**File**: `/backend/src/main/resources/application-prod.properties`
```properties
# Server Configuration
server.port=${SERVER_PORT:8080}
server.servlet.context-path=${SERVER_CONTEXT_PATH:/api}
server.compression.enabled=true
server.http2.enabled=true

# Database Configuration
spring.datasource.url=jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3306}/${DB_NAME:RATHNA}?useSSL=true&serverTimezone=UTC&allowPublicKeyRetrieval=true
spring.datasource.username=${DB_USERNAME:developer}
spring.datasource.password=${DB_PASSWORD:dev@MSQL25}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# JPA/Hibernate Configuration
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.use_sql_comments=false

# Connection Pool Configuration
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# File Upload Configuration
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=${MAX_FILE_SIZE:10MB}
spring.servlet.multipart.max-request-size=${MAX_FILE_SIZE:10MB}
spring.servlet.multipart.file-size-threshold=2KB

# JWT Configuration
app.jwt.secret=${JWT_SECRET:defaultSecretKey}
app.jwt.expiration=${JWT_EXPIRATION:86400000}

# File Storage Configuration
app.upload.dir=${UPLOAD_DIR:/opt/rathna/uploads}

# CORS Configuration
app.cors.allowed-origins=${CORS_ALLOWED_ORIGINS:http://localhost:5173}
app.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
app.cors.allowed-headers=*
app.cors.allow-credentials=true

# Logging Configuration
logging.level.com.rathna=${LOG_LEVEL:INFO}
logging.level.org.springframework.security=WARN
logging.level.org.hibernate.SQL=WARN
logging.file.name=${LOG_FILE:/var/log/rathna/application.log}
logging.file.max-size=10MB
logging.file.max-history=30

# Actuator Configuration
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when-authorized

# Security Configuration
spring.security.require-ssl=true
server.ssl.enabled=false
```

#### Create Nginx Configuration
**File**: `/etc/nginx/sites-available/rathna-products`
```nginx
# Rate limiting
limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
limit_req_zone $binary_remote_addr zone=login:10m rate=5r/m;

# Upstream backend
upstream rathna_backend {
    server 127.0.0.1:8080;
    keepalive 32;
}

server {
    listen 80;
    server_name yourdomain.com www.yourdomain.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name yourdomain.com www.yourdomain.com;
    
    # SSL Configuration (managed by certbot)
    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    
    # Security Headers
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    
    # Frontend Static Files
    root /opt/rathna/frontend/dist;
    index index.html;
    
    # Gzip Compression
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_comp_level 6;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/javascript
        application/xml+rss
        application/json
        image/svg+xml;
    
    # Static Assets Caching
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }
    
    # API Routes with Rate Limiting
    location /api/ {
        limit_req zone=api burst=20 nodelay;
        
        proxy_pass http://rathna_backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        # Timeouts
        proxy_connect_timeout 30s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
    }
    
    # Login Rate Limiting
    location ~ ^/api/(auth|admin|seller)/login$ {
        limit_req zone=login burst=5 nodelay;
        
        proxy_pass http://rathna_backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # File Upload Endpoint
    location /api/products/upload-image {
        client_max_body_size 10M;
        client_body_timeout 60s;
        
        proxy_pass http://rathna_backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # Serve uploaded files
    location /uploads/ {
        alias /opt/rathna/uploads/;
        expires 1y;
        add_header Cache-Control "public";
        access_log off;
    }
    
    # Frontend SPA Routing
    location / {
        try_files $uri $uri/ /index.html;
        
        # Cache HTML files for short time
        location ~* \.html$ {
            expires 1h;
            add_header Cache-Control "public, must-revalidate";
        }
    }
    
    # Block access to sensitive files
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }
    
    # Error pages
    error_page 404 /index.html;
    error_page 500 502 503 504 /50x.html;
    
    location = /50x.html {
        root /usr/share/nginx/html;
    }
}
```

#### Create PM2 Ecosystem Configuration
**File**: `/opt/rathna/ecosystem.config.js`
```javascript
module.exports = {
  apps: [
    {
      name: 'rathna-backend',
      script: 'java',
      args: [
        '-jar',
        '-Dspring.profiles.active=prod',
        '-Xmx2048m',
        '-Xms1024m',
        '-XX:+UseG1GC',
        '/opt/rathna/backend/build/libs/rathna-backend.jar'
      ],
      cwd: '/opt/rathna/backend',
      instances: 1,
      autorestart: true,
      watch: false,
      max_memory_restart: '2G',
      env: {
        NODE_ENV: 'production',
        SPRING_PROFILES_ACTIVE: 'prod'
      },
      error_file: '/var/log/rathna/backend-error.log',
      out_file: '/var/log/rathna/backend-out.log',
      log_file: '/var/log/rathna/backend-combined.log',
      time: true,
      log_date_format: 'YYYY-MM-DD HH:mm:ss Z'
    }
  ],
  
  deploy: {
    production: {
      user: 'rathna',
      host: 'yourdomain.com',
      ref: 'origin/main',
      repo: 'https://github.com/your-username/rathna-products.git',
      path: '/opt/rathna',
      'post-deploy': 'npm install && pm2 reload ecosystem.config.js --env production'
    }
  }
};
```

#### Create System Service Files
**File**: `/etc/systemd/system/rathna-backend.service`
```ini
[Unit]
Description=RATHNA Products Backend Service
After=network.target mysql.service
Requires=mysql.service

[Service]
Type=forking
User=rathna
Group=rathna
WorkingDirectory=/opt/rathna/backend
ExecStart=/usr/bin/java -jar -Dspring.profiles.active=prod /opt/rathna/backend/build/libs/rathna-backend.jar
ExecStop=/bin/kill -TERM $MAINPID
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal
SyslogIdentifier=rathna-backend

# Resource limits
LimitNOFILE=65536
LimitNPROC=4096

# Environment
Environment=JAVA_OPTS="-Xmx2048m -Xms1024m -XX:+UseG1GC"
Environment=SPRING_PROFILES_ACTIVE=prod

[Install]
WantedBy=multi-user.target
```

### Directory Structure Setup
```bash
# Create application directories
sudo mkdir -p /opt/rathna/{backend,frontend,uploads,logs,backups}
sudo mkdir -p /opt/rathna/uploads/{products,categories}
sudo mkdir -p /var/log/rathna

# Set ownership and permissions
sudo useradd -r -s /bin/false rathna
sudo chown -R rathna:rathna /opt/rathna
sudo chown -R rathna:rathna /var/log/rathna
sudo chmod -R 755 /opt/rathna
sudo chmod -R 755 /var/log/rathna
sudo chmod 775 /opt/rathna/uploads
```

## Local Development Setup

### 1. Clone Repository
```bash
git clone https://github.com/your-username/rathna-products.git
cd rathna-products
```

### 2. Backend Setup
```bash
cd backend

# Install Java 21 (Ubuntu)
sudo apt update
sudo apt install openjdk-21-jdk

# Verify Java installation
java -version

# Make gradlew executable
chmod +x gradlew

# Run backend
./gradlew bootRun
```

### 3. Frontend Setup
```bash
cd fronend

# Install Node.js dependencies
npm install

# Start development server
npm run dev
```

### 4. Database Setup
```sql
-- Create database
CREATE DATABASE RATHNA;

-- Create user (optional)
CREATE USER 'rathna_user'@'localhost' IDENTIFIED BY 'secure_password';
GRANT ALL PRIVILEGES ON RATHNA.* TO 'rathna_user'@'localhost';
FLUSH PRIVILEGES;
```

## Production Server Setup

### 1. Server Preparation (Ubuntu 20.04+)

```bash
# Update system
sudo apt update && sudo apt upgrade -y

# Install essential packages
sudo apt install -y curl wget git unzip software-properties-common htop ufw fail2ban

# Install Java 21
sudo apt install -y openjdk-21-jdk

# Verify Java installation
java -version
javac -version

# Set JAVA_HOME
echo 'export JAVA_HOME=/usr/lib/jvm/java-21-openjdk-amd64' >> ~/.bashrc
echo 'export PATH=$PATH:$JAVA_HOME/bin' >> ~/.bashrc
source ~/.bashrc

# Install Node.js 18+ and npm
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# Verify Node.js installation
node --version
npm --version

# Install MySQL 8.0
sudo apt install -y mysql-server mysql-client

# Secure MySQL installation
sudo mysql_secure_installation

# Install Nginx
sudo apt install -y nginx

# Install PM2 globally
sudo npm install -g pm2

# Install certbot for SSL
sudo apt install -y certbot python3-certbot-nginx

# Install additional monitoring tools
sudo apt install -y netstat-nat iotop nethogs
```

### 2. Create Application User and Directories
```bash
# Create system user for application
sudo useradd -r -m -s /bin/bash rathna
sudo usermod -aG sudo rathna

# Create application directory structure
sudo mkdir -p /opt/rathna/{backend,frontend,uploads,logs,backups,scripts}
sudo mkdir -p /opt/rathna/uploads/{products,categories}
sudo mkdir -p /var/log/rathna
sudo mkdir -p /etc/rathna

# Set ownership and permissions
sudo chown -R rathna:rathna /opt/rathna
sudo chown -R rathna:rathna /var/log/rathna
sudo chmod -R 755 /opt/rathna
sudo chmod -R 755 /var/log/rathna
sudo chmod 775 /opt/rathna/uploads

# Create symbolic links for easy access
sudo ln -sf /opt/rathna /home/rathna/app
sudo ln -sf /var/log/rathna /home/rathna/logs
```

### 3. Configure Firewall
```bash
# Enable UFW firewall
sudo ufw --force enable

# Configure firewall rules
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow ssh
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow from 127.0.0.1 to any port 8080

# Check firewall status
sudo ufw status verbose
```

### 4. Configure Fail2Ban
```bash
# Create custom jail for application
sudo tee /etc/fail2ban/jail.d/rathna.conf << EOF
[rathna-auth]
enabled = true
port = http,https
filter = rathna-auth
logpath = /var/log/rathna/application.log
maxretry = 5
bantime = 3600
findtime = 600

[nginx-limit-req]
enabled = true
filter = nginx-limit-req
action = iptables-multiport[name=ReqLimit, port="http,https", protocol=tcp]
logpath = /var/log/nginx/error.log
findtime = 600
bantime = 7200
maxretry = 10
EOF

# Create filter for authentication attempts
sudo tee /etc/fail2ban/filter.d/rathna-auth.conf << EOF
[Definition]
failregex = ^.*Authentication failed for user.*from <HOST>.*$
            ^.*Invalid login attempt from <HOST>.*$
            ^.*Failed login for.*from <HOST>.*$
ignoreregex =
EOF

# Restart fail2ban
sudo systemctl restart fail2ban
sudo systemctl enable fail2ban
```

### 5. Clone and Setup Application
```bash
# Switch to application user
sudo su - rathna

# Clone repository
cd /opt/rathna
git clone https://github.com/your-username/rathna-products.git .

# Create required configuration files from templates
cp backend/.env.example backend/.env 2>/dev/null || touch backend/.env
cp fronend/.env.example fronend/.env.production 2>/dev/null || touch fronend/.env.production

# Edit configuration files with production values
nano backend/.env
nano fronend/.env.production
```

## Database Configuration

### 1. MySQL Setup
```bash
# Secure MySQL installation
sudo mysql_secure_installation

# Login to MySQL
sudo mysql -u root -p
```

```sql
-- Create production database
CREATE DATABASE RATHNA CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- Create application user
CREATE USER 'rathna_prod'@'localhost' IDENTIFIED BY 'your_secure_password_here';
GRANT ALL PRIVILEGES ON RATHNA.* TO 'rathna_prod'@'localhost';
FLUSH PRIVILEGES;

-- Exit MySQL
EXIT;
```

### 2. Database Configuration File
Create `/home/rathna/db-config.properties`:
```properties
spring.datasource.url=jdbc:mysql://localhost:3306/RATHNA?useSSL=true&serverTimezone=UTC
spring.datasource.username=rathna_prod
spring.datasource.password=your_secure_password_here
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect
```

## Backend Deployment

### 1. Build Application
```bash
# Clone repository to server
cd /home/rathna
git clone https://github.com/your-username/rathna-products.git
cd rathna-products/backend

# Make gradlew executable
chmod +x gradlew

# Build application
./gradlew build -x test

# The JAR file will be in build/libs/
```

### 2. Create Production Configuration
Create `/home/rathna/rathna-products/backend/src/main/resources/application-prod.properties`:
```properties
# Server configuration
server.port=8080
server.servlet.context-path=/api

# Database configuration
spring.datasource.url=jdbc:mysql://localhost:3306/RATHNA?useSSL=true&serverTimezone=UTC
spring.datasource.username=rathna_prod
spring.datasource.password=your_secure_password_here
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# JPA/Hibernate configuration
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect

# File upload configuration
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# Logging configuration
logging.level.com.rathna=INFO
logging.file.name=/home/rathna/logs/rathna-backend.log

# CORS configuration
app.cors.allowed-origins=https://yourdomain.com,https://www.yourdomain.com
```

### 3. Create PM2 Ecosystem File
Create `/home/rathna/ecosystem.config.js`:
```javascript
module.exports = {
  apps: [
    {
      name: 'rathna-backend',
      script: 'java',
      args: [
        '-jar',
        '-Dspring.profiles.active=prod',
        '/home/rathna/rathna-products/backend/build/libs/rathna-backend.jar'
      ],
      cwd: '/home/rathna/rathna-products/backend',
      instances: 1,
      autorestart: true,
      watch: false,
      max_memory_restart: '1G',
      env: {
        NODE_ENV: 'production',
        JAVA_OPTS: '-Xmx1024m -Xms512m'
      },
      error_file: '/home/rathna/logs/backend-error.log',
      out_file: '/home/rathna/logs/backend-out.log',
      log_file: '/home/rathna/logs/backend-combined.log'
    }
  ]
};
```

### 4. Start Backend Service
```bash
# Create logs directory
mkdir -p /home/rathna/logs

# Start application with PM2
cd /home/rathna
pm2 start ecosystem.config.js

# Save PM2 configuration
pm2 save

# Setup PM2 to start on boot
pm2 startup
# Follow the instructions provided by the command above
```

## Frontend Deployment

### 1. Build Frontend
```bash
cd /home/rathna/rathna-products/fronend

# Install dependencies
npm install

# Update API URL for production
# Edit src/config.js
nano src/config.js
```

Update `src/config.js`:
```javascript
// config.js
export const API_URL = 'https://yourdomain.com/api';
```

```bash
# Build for production
npm run build

# The built files will be in dist/ directory
```

### 2. Configure Nginx
Create `/etc/nginx/sites-available/rathna-products`:
```nginx
server {
    listen 80;
    server_name yourdomain.com www.yourdomain.com;
    
    # Redirect HTTP to HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name yourdomain.com www.yourdomain.com;
    
    # SSL configuration (will be added by certbot)
    
    # Frontend files
    root /home/rathna/rathna-products/fronend/dist;
    index index.html;
    
    # Gzip compression
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;
    
    # Frontend routing (SPA)
    location / {
        try_files $uri $uri/ /index.html;
        
        # Cache static assets
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
    }
    
    # API proxy
    location /api/ {
        proxy_pass http://localhost:8080/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Handle CORS
        add_header Access-Control-Allow-Origin *;
        add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS";
        add_header Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept, Authorization";
        
        if ($request_method = 'OPTIONS') {
            return 204;
        }
    }
    
    # File uploads
    location /api/products/upload-image {
        proxy_pass http://localhost:8080/api/products/upload-image;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        client_max_body_size 10M;
    }
    
    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
    add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;
}
```

### 3. Enable Nginx Site
```bash
# Enable the site
sudo ln -s /etc/nginx/sites-available/rathna-products /etc/nginx/sites-enabled/

# Test Nginx configuration
sudo nginx -t

# Restart Nginx
sudo systemctl restart nginx
```

## CI/CD Pipeline Setup

### 1. GitHub Actions Workflow
Create `.github/workflows/deploy.yml`:
```yaml
name: Deploy RATHNA Products

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up JDK 21
      uses: actions/setup-java@v3
      with:
        java-version: '21'
        distribution: 'temurin'
    
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    
    - name: Test Backend
      run: |
        cd backend
        chmod +x gradlew
        ./gradlew test
    
    - name: Test Frontend
      run: |
        cd fronend
        npm install
        npm run build

  deploy:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
    - name: Deploy to server
      uses: appleboy/ssh-action@v0.1.5
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        key: ${{ secrets.SSH_KEY }}
        script: |
          cd /home/rathna/rathna-products
          git pull origin main
          
          # Build backend
          cd backend
          chmod +x gradlew
          ./gradlew build -x test
          
          # Build frontend
          cd ../fronend
          npm install
          npm run build
          
          # Restart services
          pm2 restart rathna-backend
          sudo systemctl reload nginx
```

### 2. Setup GitHub Secrets
In your GitHub repository, go to Settings > Secrets and add:
- `HOST`: Your server IP address
- `USERNAME`: Server username (rathna)
- `SSH_KEY`: Private SSH key for server access

## Environment Configuration

### 1. Environment Variables
Create `/home/rathna/.env`:
```bash
# Database
DB_HOST=localhost
DB_PORT=3306
DB_NAME=RATHNA
DB_USER=rathna_prod
DB_PASSWORD=your_secure_password_here

# Application
APP_ENV=production
APP_PORT=8080
APP_DOMAIN=yourdomain.com

# JWT Secret (generate a secure random string)
JWT_SECRET=your_jwt_secret_key_here

# File upload path
UPLOAD_PATH=/home/rathna/uploads
```

### 2. Create Upload Directories
```bash
# Create upload directories
mkdir -p /home/rathna/uploads/products
mkdir -p /home/rathna/uploads/categories

# Set permissions
chmod 755 /home/rathna/uploads
chmod 755 /home/rathna/uploads/products
chmod 755 /home/rathna/uploads/categories
```

## SSL & Domain Setup

### 1. Obtain SSL Certificate
```bash
# Install SSL certificate using Let's Encrypt
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com

# Test automatic renewal
sudo certbot renew --dry-run
```

### 2. Setup Auto-renewal
```bash
# Add cron job for certificate renewal
sudo crontab -e

# Add this line:
0 12 * * * /usr/bin/certbot renew --quiet
```

## Monitoring & Maintenance

### 1. Setup Log Rotation
Create `/etc/logrotate.d/rathna-products`:
```
/home/rathna/logs/*.log {
    daily
    missingok
    rotate 52
    compress
    delaycompress
    notifempty
    create 644 rathna rathna
    postrotate
        pm2 reload rathna-backend
    endscript
}
```

### 2. Monitoring Commands
```bash
# Check application status
pm2 status

# View logs
pm2 logs rathna-backend

# Monitor system resources
htop

# Check Nginx status
sudo systemctl status nginx

# Check MySQL status
sudo systemctl status mysql

# View Nginx access logs
sudo tail -f /var/log/nginx/access.log

# View Nginx error logs
sudo tail -f /var/log/nginx/error.log
```

### 3. Backup Script
Create `/home/rathna/backup.sh`:
```bash
#!/bin/bash

# Backup script for RATHNA Products
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/home/rathna/backups"
DB_NAME="RATHNA"
DB_USER="rathna_prod"
DB_PASS="your_secure_password_here"

# Create backup directory
mkdir -p $BACKUP_DIR

# Database backup
mysqldump -u $DB_USER -p$DB_PASS $DB_NAME > $BACKUP_DIR/db_backup_$DATE.sql

# Files backup
tar -czf $BACKUP_DIR/files_backup_$DATE.tar.gz /home/rathna/uploads

# Keep only last 7 days of backups
find $BACKUP_DIR -name "*.sql" -mtime +7 -delete
find $BACKUP_DIR -name "*.tar.gz" -mtime +7 -delete

echo "Backup completed: $DATE"
```

```bash
# Make backup script executable
chmod +x /home/rathna/backup.sh

# Add to crontab for daily backups
crontab -e

# Add this line for daily backup at 2 AM:
0 2 * * * /home/rathna/backup.sh
```

## Deployment Checklist

### Pre-deployment
- [ ] Server meets system requirements
- [ ] Domain name configured and pointing to server
- [ ] SSL certificate obtained
- [ ] Database created and configured
- [ ] Environment variables set
- [ ] Upload directories created with proper permissions

### Deployment
- [ ] Code pulled from repository
- [ ] Backend built and tested
- [ ] Frontend built with production API URL
- [ ] PM2 ecosystem configured
- [ ] Nginx configured and tested
- [ ] Services started and running

### Post-deployment
- [ ] Application accessible via domain
- [ ] All features working correctly
- [ ] SSL certificate valid
- [ ] Logs being generated properly
- [ ] Backup script configured
- [ ] Monitoring setup complete

## Troubleshooting

### Common Issues

1. **Backend not starting**
   ```bash
   # Check logs
   pm2 logs rathna-backend
   
   # Check Java version
   java -version
   
   # Check database connection
   mysql -u rathna_prod -p RATHNA
   ```

2. **Frontend not loading**
   ```bash
   # Check Nginx configuration
   sudo nginx -t
   
   # Check Nginx logs
   sudo tail -f /var/log/nginx/error.log
   
   # Verify build files exist
   ls -la /home/rathna/rathna-products/fronend/dist/
   ```

3. **Database connection issues**
   ```bash
   # Check MySQL status
   sudo systemctl status mysql
   
   # Check MySQL logs
   sudo tail -f /var/log/mysql/error.log
   
   # Test connection
   mysql -u rathna_prod -p -h localhost RATHNA
   ```

4. **File upload issues**
   ```bash
   # Check upload directory permissions
   ls -la /home/rathna/uploads/
   
   # Check Nginx client_max_body_size
   grep -r client_max_body_size /etc/nginx/
   ```

## Security Considerations

1. **Firewall Configuration**
   ```bash
   # Enable UFW firewall
   sudo ufw enable
   
   # Allow SSH, HTTP, and HTTPS
   sudo ufw allow ssh
   sudo ufw allow 80
   sudo ufw allow 443
   
   # Check status
   sudo ufw status
   ```

2. **Regular Updates**
   ```bash
   # Update system packages
   sudo apt update && sudo apt upgrade
   
   # Update Node.js dependencies
   cd /home/rathna/rathna-products/fronend
   npm audit fix
   ```

3. **Database Security**
   - Use strong passwords
   - Limit database user privileges
   - Regular backups
   - Monitor access logs

## Complete Deployment Checklist

### Pre-deployment Requirements
- [ ] Server meets minimum system requirements (4GB RAM, 50GB SSD, 2+ CPU cores)
- [ ] Domain name purchased and DNS configured
- [ ] SSL certificate ready for installation
- [ ] Database server installed and secured
- [ ] All required software installed (Java 21, Node.js 18+, MySQL 8.0, Nginx, PM2)
- [ ] Firewall configured and enabled
- [ ] Fail2Ban configured for security
- [ ] Application user created with proper permissions

### Environment Setup
- [ ] All gitignored files created:
  - [ ] `/backend/.env` with production database credentials
  - [ ] `/fronend/.env.production` with production API URL
  - [ ] `/backend/src/main/resources/application-prod.properties`
  - [ ] `/etc/nginx/sites-available/rathna-products`
  - [ ] `/opt/rathna/ecosystem.config.js`
  - [ ] `/etc/systemd/system/rathna-backend.service`
- [ ] Upload directories created with proper permissions:
  - [ ] `/opt/rathna/uploads/products/`
  - [ ] `/opt/rathna/uploads/categories/`
- [ ] Log directories created:
  - [ ] `/var/log/rathna/`
  - [ ] `/opt/rathna/logs/`

### Application Deployment
- [ ] Repository cloned to `/opt/rathna/`
- [ ] Backend built successfully (`./gradlew build`)
- [ ] Frontend built with production configuration (`npm run build`)
- [ ] Database schema created and populated
- [ ] PM2 ecosystem configured and started
- [ ] Nginx configuration tested and enabled
- [ ] SSL certificate installed and configured
- [ ] Services started and running:
  - [ ] MySQL service active
  - [ ] Nginx service active
  - [ ] PM2 rathna-backend process running

### Post-deployment Verification
- [ ] Application accessible via HTTPS
- [ ] All API endpoints responding correctly
- [ ] File upload functionality working
- [ ] Database connections established
- [ ] SSL certificate valid and auto-renewal configured
- [ ] Logs being generated properly
- [ ] Backup scripts configured and tested
- [ ] Monitoring tools configured
- [ ] Performance optimization applied

### Security Verification
- [ ] Firewall rules properly configured
- [ ] Fail2Ban active and monitoring
- [ ] SSL/TLS configuration secure
- [ ] Database access restricted
- [ ] File permissions properly set
- [ ] Security headers configured in Nginx
- [ ] Rate limiting enabled
- [ ] Sensitive files protected

## Quick Deployment Commands

### One-time Server Setup
```bash
# Run as root user
curl -fsSL https://raw.githubusercontent.com/your-username/rathna-products/main/scripts/server-setup.sh | bash
```

### Application Deployment
```bash
# Run as rathna user
cd /opt/rathna
git pull origin main
./scripts/deploy.sh
```

### Service Management
```bash
# Check all services
sudo systemctl status mysql nginx
pm2 status

# Restart services
sudo systemctl restart nginx
pm2 restart rathna-backend

# View logs
pm2 logs rathna-backend
sudo tail -f /var/log/nginx/error.log
sudo tail -f /var/log/rathna/application.log
```

## Performance Optimization

### Database Optimization
```sql
-- Add indexes for better performance
CREATE INDEX idx_product_category ON products(category_id);
CREATE INDEX idx_order_user ON orders(user_id);
CREATE INDEX idx_order_date ON orders(created_at);
CREATE INDEX idx_product_active ON products(is_active);

-- Optimize MySQL configuration
-- Add to /etc/mysql/mysql.conf.d/mysqld.cnf
[mysqld]
innodb_buffer_pool_size = 1G
innodb_log_file_size = 256M
max_connections = 200
query_cache_size = 64M
query_cache_type = 1
```

### Nginx Optimization
```nginx
# Add to nginx.conf
worker_processes auto;
worker_connections 1024;
keepalive_timeout 65;
client_max_body_size 10M;

# Enable HTTP/2
listen 443 ssl http2;

# Enable Brotli compression (if available)
brotli on;
brotli_comp_level 6;
brotli_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
```

### JVM Optimization
```bash
# Update ecosystem.config.js with optimized JVM flags
args: [
  '-jar',
  '-Dspring.profiles.active=prod',
  '-Xmx2048m',
  '-Xms1024m',
  '-XX:+UseG1GC',
  '-XX:MaxGCPauseMillis=200',
  '-XX:+UseStringDeduplication',
  '-XX:+OptimizeStringConcat',
  '/opt/rathna/backend/build/libs/rathna-backend.jar'
]
```